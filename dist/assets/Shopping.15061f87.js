import{V as G,c as t,n as E,u as W,a as N,r as C,y as l,z as T,E as U,B as g,j as c,G as r,W as O,v as B,q as z,X as Q,Y as R,l as V,Z as J,J as _,N as F,p as M,C as H,$ as X,T as Z,a0 as K,a1 as ee,Q as D}from"./index.a66382f1.js";const j=G(t("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function te(e){var P,A,Y,L;const d=E(),u=W(),{products:a,complete:v}=N(n=>d.user?n.apiCart:n.cart),[p,k]=C.exports.useState(0),[f,I]=C.exports.useState(e.quantity),[y,$]=C.exports.useState(""),o=a==null?void 0:a.find(n=>n.idProduct===e.idProduct);C.exports.useEffect(()=>{var n;if(k(p+1),d.user)b();else{const s=document.getElementById(`localAmount${e.idProduct}`);((n=o==null?void 0:o.sizeCart)==null?void 0:n.stock)&&parseInt(s.value)>o.sizeCart.stock&&(l.fire({text:"We will update your amount cause you have more than stock available",icon:"warning"}),e.idProduct&&u(T({method:"modify",id:e.idProduct,sizes:{stock:o.sizeCart.stock}})))}},[v]);const S=n=>{n.preventDefault(),e.idProduct&&u(T({method:n.currentTarget.name,id:e.idProduct,sizes:{}}))},q=async n=>{var s;n.preventDefault(),e.quantity!==f?((s=e==null?void 0:e.sizeCart)==null?void 0:s.stock)!==void 0&&f!==void 0&&e.sizeCart.stock>=f?(await u(U({idUser:d.id,idProduct:e.idProduct,quantity:f})),l.fire({text:"Amount updated succesfully",icon:"success",timer:1500})):l.fire({title:"Error",text:"can't exceed stock amount",icon:"error",confirmButtonText:"Try Again"}):l.fire({text:"You already have that quantity",icon:"warning",confirmButtonText:"Ok!"})},i=n=>{var s;if(d.user)$(n.target.value);else{const x=(s=e==null?void 0:e.size)==null?void 0:s.find(w=>w.size===n.target.value);e.idProduct&&x&&u(T({method:n.currentTarget.name,id:e.idProduct,sizes:x}))}},h=async n=>{var x;n.preventDefault();const s=(x=e==null?void 0:e.size)==null?void 0:x.find(w=>w.size===y);if((s==null?void 0:s.stock)===0)l.fire({text:"Can't change your size cause there is not more stock available",icon:"warning"});else{await u(U({idUser:d.id,idProduct:e.idProduct,id_size:s==null?void 0:s.id})),l.fire({text:"Size updated succesfully",icon:"success",timer:500});const w=document.getElementById("selectSize");w.value="currentSize"}},b=()=>{var s;const n=document.getElementById(`apiAmount${e.idProduct}`);((s=o==null?void 0:o.sizeCart)==null?void 0:s.stock)&&parseInt(n.value)>o.sizeCart.stock&&(l.fire({text:"We will update your amount cause you have more than stock available",icon:"warning"}),u(U({idUser:d.id,idProduct:e.idProduct,quantity:o.sizeCart.stock})))},m=(n,s)=>{n.preventDefault(),l.fire({title:"Are you sure?",text:"You will delete that product from your cart!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async x=>{x.isConfirmed&&(d.user?(await u(R({idUser:d.id,idProduct:s})),v&&l.fire("Deleted!","Your product has been deleted.","success")):(u(Q(s)),l.fire("Deleted!","Your product has been deleted.","success")))})};return t(g,{children:c(r,{container:!0,spacing:0,alignItems:"center",children:[t(r,{item:!0,xs:1,children:t("img",{style:{width:"80%"},src:e.image?e.image:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Unknown_person.jpg/925px-Unknown_person.jpg",alt:"No hay"})}),t(r,{item:!0,xs:11,children:c(r,{container:!0,children:[t(r,{item:!0,xs:4,children:t("label",{children:"Title"})}),t(r,{item:!0,xs:1,children:t("label",{children:"Price"})}),t(r,{item:!0,xs:1,children:t("label",{children:"Size"})}),t(r,{item:!0,xs:1,children:t("label",{children:"Stock"})}),t(r,{item:!0,xs:2,children:t("label",{children:"Amount"})}),t(r,{item:!0,xs:1,children:t("label",{children:"Total"})}),t(r,{item:!0,xs:4,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:t(O,{style:{fontSize:"smaller"},to:`${B.products}/${e.idProduct}`,children:e.name})}),t(r,{item:!0,xs:1,children:c("p",{children:["$ ",e.price]})}),c(r,{item:!0,xs:1,children:[c("span",{style:{marginTop:5},children:["Current: ",(P=o==null?void 0:o.sizeCart)==null?void 0:P.size]}),c(g,{display:d.user?"flex":"inherit",gap:1,children:[c("select",{name:"changeSize",style:{width:"min-content"},id:"selectSize",defaultValue:"currentSize",onChange:i,children:[t("option",{id:"currentSize",value:"currentSize",disabled:!0,children:"sizes"}),(A=e==null?void 0:e.size)==null?void 0:A.map(n=>t("option",{children:n.size},n.size))]}),d.user&&t(z,{variant:"contained",title:"Update!",sx:{minWidth:"max-content",padding:0},name:"apiUpdate",onClick:h,children:t(j,{sx:{width:"fit-content"}})})]})]}),t(r,{item:!0,xs:1,children:t("p",{children:(Y=e==null?void 0:e.sizeCart)==null?void 0:Y.stock})}),!d.user&&c(r,{item:!0,xs:2,display:"flex",alignItems:"center",justifyContent:"center",children:[t("button",{name:"decrease",disabled:e.quantity?e.quantity===1:!1,style:{width:"25px"},onClick:S,children:"-"}),t("input",{id:`localAmount${e.idProduct}`,disabled:!0,defaultValue:e.quantity,style:{width:"20px",textAlign:"center"}}),t("button",{name:"increase",disabled:e.quantity&&((L=e.sizeCart)==null?void 0:L.stock)?e.quantity>=e.sizeCart.stock:!1,style:{width:"25px"},onClick:S,children:"+"})]}),d.user&&c(r,{item:!0,xs:2,display:"flex",gap:1,alignItems:"center",justifyContent:"center",children:[t("input",{id:`apiAmount${e.idProduct}`,type:"number",title:"can't exceed stock",value:f,style:{width:"20px",textAlign:"center"},onChange:n=>I(Number(n.target.value))}),t(z,{variant:"contained",title:"Update!",sx:{minWidth:"max-content",padding:0},name:"apiUpdate",onClick:q,children:t(j,{sx:{width:"fit-content"}})})]}),t(r,{item:!0,xs:1,children:c("p",{children:["$ ",e.price&&e.quantity?e.quantity*e.price:0]})}),t(r,{item:!0,xs:2,children:t(z,{variant:"contained",sx:{border:"1px solid primary.main"},onClick:n=>e.idProduct&&m(n,e.idProduct),children:"Delete"})})]})})]})})}function ne(){const e=E(),d=window.localStorage.getItem("userInfo")?JSON.parse(window.localStorage.getItem("userInfo")):null,{loading:u,products:a,total:v}=N(i=>e.user?i.apiCart:i.cart),p=V(),k=W(),[f,I]=C.exports.useState(0),{data:y,isLoading:$}=J();C.exports.useEffect(()=>{window.scrollTo(0,0)},[]),C.exports.useEffect(()=>{if(!e.user){let i=0;a==null||a.forEach(h=>{h.price&&h.quantity&&(i=i+h.price*h.quantity)}),I(i)}},[a]);const o=_(F)(({theme:i})=>({backgroundColor:i.palette.mode==="dark"?"#1A2027":"#fff",...i.typography.body2,padding:i.spacing(1),maxWidth:"100%",maxHeight:"10%",textAlign:"center",color:i.palette.text.secondary})),S=i=>{i.preventDefault(),l.fire({title:"Are you sure?",text:"You will delete all products from your cart!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete them!"}).then(async h=>{h.isConfirmed&&(e.user?(await k(R({idUser:d.id})),l.fire("Deleted!","Your products has been deleted.","success")):(k(ee()),l.fire("Deleted!","Your products has been deleted.","success")))})},q=i=>{i.preventDefault(),l.fire({title:"Confirm purchase?",text:"You can add more products to your cart!",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirm!"}).then(h=>{if(h.isConfirmed)if(!e.user)l.fire({title:"Wait!",icon:"error",text:"First you need to Sign In! Redirecting!",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{p(B.login)},1e3);else if(!y)l.fire({icon:"error",text:"You don't have any address to select, please add one",timer:1500}),setTimeout(()=>{p(`${D.settings}/${D.addaddress}`)},1500);else{const b={};y.map(m=>{b[m.id?m.id:0]=`${m.address} - ${m.city}`}),l.fire({title:"Please, select one address",icon:"question",showConfirmButton:!0,showCancelButton:!0,input:"select",inputOptions:b,inputPlaceholder:"Available addresses",cancelButtonColor:"#d33"}).then(async m=>{if(m.isConfirmed){const P=y==null?void 0:y.find(A=>A.id.toString()===m.value);window.localStorage.setItem("deliveryAddress",JSON.stringify(P)),p(D.checkout)}})}})};return c(g,{height:"80%",children:[t("h3",{children:"Your current Shopping Cart"}),u&&t(M,{sx:{color:"primary.main",zIndex:i=>i.zIndex.drawer+1},open:!0,children:t(H,{color:"inherit",size:200})}),t(X,{spacing:2,alignItems:"center",children:a!=null&&a.length?a==null?void 0:a.map(i=>t(o,{children:t(te,{idUser:e.user?i.idUser:null,idProduct:i.idProduct,image:i.image,name:i.name,color:i.color,size:i.size,price:i.price,sizeCart:i.sizeCart,quantity:i.quantity})},i.idProduct)):c(o,{children:["There are any products in the cart, try go to our ",t(O,{to:B.products,children:"Products List"})," and get someones"]})}),(a==null?void 0:a.length)<=1?null:t(g,{display:"flex",justifyContent:"flex-end",margin:2,children:t(z,{sx:{width:120},variant:"contained",onClick:S,children:"Delete All"})}),a!=null&&a.length?c(g,{display:"flex",justifyContent:"flex-end",gap:5,margin:2,children:[c(Z,{variant:"body1",color:"text.secondary",sx:{alignSelf:"center"},children:["Total: $ ",e.user?v:f]}),t(z,{sx:{width:120},variant:"contained",onClick:q,children:"Buy Now!"})]}):null,a!=null&&a.length?t(g,{sx:{height:"20%"},children:c(g,{display:"flex",flexDirection:"row",alignItems:"center",gap:2,children:[t("h3",{children:"Want to buy more? Go to our"}),t(z,{sx:{height:"min-content"},variant:"contained",onClick:()=>p(B.products),children:"Product List"})]})}):null,t("h2",{children:"Recommended"}),t(K,{})]})}export{ne as default};
